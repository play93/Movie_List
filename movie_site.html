<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<title>index</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
		crossorigin="anonymous"></script>
	<style>

	</style>
	<script type="module">

		//==========API요청
		const options = {
			method: 'GET',
			headers: {
				accept: 'application/json',
				Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJmMzBjMzBmM2YyNzk1MWE2NjgzMjY1OTdiNDIzOWYwNiIsIm5iZiI6MTcyMTYxODQ1NS41NjQ4MjEsInN1YiI6IjY2OWRjYjY2NzU3MzRjMjdkMmE2ZTdlYyIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.M46lKUN6qNB8wCVMdsjOcWdT88MvAPECmgg0GJFvsjk'
			}
		};

		// 본인의 API 키를 넣어주셔야 합니다.
		const API_KEY = 'f30c30f3f27951a668326597b4239f06';
		const URL = `https://api.themoviedb.org/3/movie/popular?api_key=${API_KEY}&language=ko&page=1`;

		fetch(URL)
			.then(response => response.json())
			.then(data => {
				console.log(data);
				// 이후 데이터 처리
			})
			.catch(error => console.error('Error:', error));

		//==================



		//자바스크립트로 카드 생성
		function createMovieCard(movie) {
			const card = document.createElement('div');
			card.className = 'movie-card';

			// 별 갯수 계산
			const fullStars = Math.floor(movie.vote_average / 2);
			const emptyStars = 5 - fullStars;

			// 별 생성
			let stars = '';
			for (let i = 0; i < fullStars; i++) {
				stars += '★'; // 까만 별
			}
			for (let i = 0; i < emptyStars; i++) {
				stars += '☆'; // 빈 별
			}

			card.innerHTML = `
    <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" alt="${movie.title}">
    <h3>${movie.title}</h3>
    <p>${movie.overview}</p>
    <span>Rating: ${stars} ${movie.vote_average}</span>
  `;
			card.addEventListener('click', () => alert(`Movie ID: ${movie.id}`));
			return card;
		}


		//받아온 데이터로 카드 생성 및 DOM에 추가
		fetch(URL)
			.then(response => response.json())
			.then(data => {
				const movies = data.results;
				const movieContainer = document.getElementById('movie-container');
				movies.forEach(movie => {
					const card = createMovieCard(movie);
					movieContainer.appendChild(card);
				});
			})
			.catch(error => console.error('Error:', error));


		//검색기능구현
		document.getElementById('search-button').addEventListener('click', () => {
			const query = document.getElementById('search-input').value.toLowerCase();
			const movieCards = document.querySelectorAll('.movie-card');
			movieCards.forEach(card => {
				const title = card.querySelector('h3').textContent.toLowerCase();
				if (title.includes(query)) {
					card.style.display = 'block';
				} else {
					card.style.display = 'none';
				}
			});
		});



	</script>
</head>

<body>
	<header>
		<h1>🎬서치무비</h1>
	</header>
	<div class="searcg-movie">
		<form>
			<label>영화 검색 : </label>
			<input type="text" id="search-input" placeholder="Search for a movie...">
			<button id="search-button" type="button">Search</button>
		</form>
	</div>
	<div id="movie-container">
	</div>
</body>

</html>